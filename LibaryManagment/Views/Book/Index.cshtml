@model List<LibaryManagment.Models.BookModel>

@{
    ViewData["Title"] = "Books";
}

<!doctype html>
<html lang="en">

<body>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Library Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/BookIndex.css">
</head>



<div class="container-fluid px-4">
    <div class="books-header">
        <h1 class="page-title">üìö Library Books</h1>
        @if (User.IsInRole("admin") || User.IsInRole("lib"))
        {
            <a class="btn btn-primary btn-lg" href="/Book/Create">
                ‚ûï Add New Book
            </a>
        }
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
        <form method="get" asp-action="Index">
            <div class="search-bar">
                <div class="search-input-group">
                    <span class="search-icon">üîç</span>
                    @* <input type="text"  *@
                    @*        name="searchTerm"  *@
                    @*        class="search-input"  *@
                    @*        placeholder="Search by book name, author, or publisher..." *@
                    @*        value="@ViewBag.SearchTerm" /> *@
                    
                    <input type="text" 
                           name="searchTerm" 
                           class="search-input" 
                           placeholder="Search book title (use author: or publisher: for specific search)..."
                           value="@ViewBag.SearchTerm" 
                           title="–ü—Ä–∏–∫–ª–∞–¥–∏: 'Harry Potter', 'author:Tolkien', 'publisher:Penguin'" />
                </div>
            </div>
            
            <div class="filter-group">
                <div class="filter-item">
                    <label class="filter-label">Category</label>
                    <select name="categoryId" class="filter-select">
                        <option value="">All Categories</option>
                        @if (ViewBag.Categories != null)
                        {
                            @foreach (var category in ViewBag.Categories)
                            {
                                <option value="@category.CategoryID" 
                                        selected="@(ViewBag.CategoryId == category.CategoryID.ToString())">
                                    @category.CategoryName
                                </option>
                            }
                        }
                    </select>
                </div>
                
                <div class="filter-item">
                    <label class="filter-label">Availability</label>
                    <select name="availability" class="filter-select">
                        <option value="">All Books</option>
                        <option value="available" selected="@(ViewBag.Availability == "available")">Available Only</option>
                        <option value="unavailable" selected="@(ViewBag.Availability == "unavailable")">Unavailable Only</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label class="filter-label">Year</label>
                    <select name="year" class="filter-select">
                        <option value="">All Years</option>
                        @if (ViewBag.Years != null)
                        {
                            @foreach (var year in ViewBag.Years)
                            {
                                <option value="@year" selected="@(ViewBag.Year == year.ToString())">@year</option>
                            }
                        }
                    </select>
                </div>
                
                <div class="filter-buttons">
                    <button type="submit" class="btn-filter btn-apply-filter">
                        üîé Apply Filters
                    </button>
                    <a href="@Url.Action("Index")" class="btn-filter btn-clear-filter">
                        ‚úñÔ∏è Clear
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Results Info -->
    <div class="results-info">
        <span class="results-count">
            Showing @Model.Count @(Model.Count == 1 ? "book" : "books")
        </span>
    </div>

    <!-- Books Grid -->
    @if (Model.Any())
    {
        <div class="books-grid">
            @foreach (var item in Model)
            {
                <div class="book-card">
                    <div class="book-image-container">
                        @if (item.BookImage != null && item.BookImage.Length > 0)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(item.BookImage)" 
                                 alt="@item.BookName" />
                        }
                        else
                        {
                            <span class="book-image-placeholder">üìñ</span>
                        }
                    </div>
                    
                    <div class="book-card-body">
                        <h3 class="book-title">@item.BookName</h3>
                        <p class="book-author">by @item.AuthorName</p>
                        
                        <div class="availability-badge @(item.CopiesAvailable > 0 ? "available" : "unavailable")">
                            <span>@(item.CopiesAvailable > 0 ? "‚úì" : "‚úó")</span>
                            <span>@item.CopiesAvailable / @item.CopiesTotal Available</span>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(item.BookDescription))
                        {
                            <p class="book-description">@item.BookDescription</p>
                        }
                        
                        <div class="book-details">
                            <div class="book-detail-item">
                                <span class="book-detail-label">Year</span>
                                <span class="book-detail-value">@item.Year</span>
                            </div>
                            <div class="book-detail-item">
                                <span class="book-detail-label">Publisher</span>
                                <span class="book-detail-value">@item.Publisher</span>
                            </div>
                            <div class="book-detail-item">
                                <span class="book-detail-label">Category</span>
                                <span class="book-detail-value">@item.CategoryName</span>
                            </div>
                            <div class="book-detail-item">
                                <span class="book-detail-label">Book ID</span>
                                <span class="book-detail-value">#@item.BookId</span>
                            </div>
                        </div>
                        
                        
                        <div class="card-footer">
                            <a asp-action="Details" asp-route-id="@item.BookId" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i> View Details
                            </a>
                            @if (User.IsInRole("admin") || User.IsInRole("lib"))
                            {
                                <a asp-action="Edit" asp-route-id="@item.BookId" class="btn btn-warning btn-sm">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.BookId" class="btn btn-danger btn-sm"
                                   onclick="return confirm('Are you sure you want to delete this book?')">
                                    <i class="fas fa-trash"></i> Delete
                                </a>
                            }
                        </div>
                        
                        
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-results">
            <div class="no-results-icon">üîç</div>
            <div class="no-results-text">No books found matching your search criteria</div>
            <p>Try adjusting your filters or search terms</p>
        </div>
    }
</div>

</body>
</html>
