@model List<LibaryManagment.Models.BookModel>
@using Microsoft.AspNetCore.Mvc.Localization
@using LibaryManagment
@inject IHtmlLocalizer<SharedResource> Localizer

@{
    ViewData["Title"] = Localizer["Book_Index_TabTitle"];
}

<link rel="stylesheet" href="/css/BookIndex.css">

<div class="container-fluid px-4">
    <div class="books-header">
        <h1 class="page-title">üìö @Localizer["Book_Index_Title"]</h1>
        @if (User.IsInRole("admin") || User.IsInRole("lib"))
        {
            <a class="btn btn-primary btn-lg" href="/Book/Create">
                ‚ûï @Localizer["Book_Index_Btn_Add"]
            </a>
        }
    </div>

    <div class="search-filter-section">
        <form method="get" asp-action="Index">
            <div class="search-bar">
                <div class="search-input-group">
                    <span class="search-icon">üîç</span>
                    
                    <input type="text" 
                           name="searchTerm" 
                           class="search-input" 
                           placeholder="@Localizer["Book_Search_Placeholder"]"
                           value="@ViewBag.SearchTerm" 
                           title="@Localizer["Book_Search_Tooltip"]" />
                </div>
            </div>
            
            <div class="filter-group">
                <div class="filter-item">
                    <label class="filter-label">@Localizer["Book_Filter_Label_Category"]</label>
                    <select name="categoryId" class="filter-select">
                        <option value="">@Localizer["Book_Filter_Option_AllCategories"]</option>
                        @if (ViewBag.Categories != null)
                        {
                            @foreach (var category in ViewBag.Categories)
                            {
                                <option value="@category.CategoryID" 
                                        selected="@(ViewBag.CategoryId == category.CategoryID.ToString())">
                                    @category.CategoryName
                                </option>
                            }
                        }
                    </select>
                </div>
                
                <div class="filter-item">
                    <label class="filter-label">@Localizer["Book_Filter_Label_Availability"]</label>
                    <select name="availability" class="filter-select">
                        <option value="">@Localizer["Book_Filter_Option_AllBooks"]</option>
                        <option value="available" selected="@(ViewBag.Availability == "available")">@Localizer["Book_Filter_Option_Available"]</option>
                        <option value="unavailable" selected="@(ViewBag.Availability == "unavailable")">@Localizer["Book_Filter_Option_Unavailable"]</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <label class="filter-label">@Localizer["Book_Filter_Label_Year"]</label>
                    <select name="year" class="filter-select">
                        <option value="">@Localizer["Book_Filter_Option_AllYears"]</option>
                        @if (ViewBag.Years != null)
                        {
                            @foreach (var year in ViewBag.Years)
                            {
                                <option value="@year" selected="@(ViewBag.Year == year.ToString())">@year</option>
                            }
                        }
                    </select>
                </div>
                
                <div class="filter-buttons">
                    <button type="submit" class="btn-filter btn-apply-filter">
                        üîé @Localizer["Book_Filter_Btn_Apply"]
                    </button>
                    <a href="@Url.Action("Index")" class="btn-filter btn-clear-filter">
                        ‚úñÔ∏è @Localizer["Book_Filter_Btn_Clear"]
                    </a>
                </div>
            </div>
        </form>
    </div>

    <div class="results-info">
        <span class="results-count">
            @Localizer["Book_Index_ResultsCount", Model.Count]
        </span>
    </div>

    @if (Model.Any())
    {
        <div class="books-grid">
            @foreach (var item in Model)
            {
                <div class="book-card">
                    <div class="book-image-container">
                        @if (item.BookImage != null && item.BookImage.Length > 0)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(item.BookImage)" 
                                 alt="@item.BookName" />
                        }
                        else
                        {
                            <span class="book-image-placeholder">üìñ</span>
                        }
                    </div>
                    
                    <div class="book-card-body">
                        <h3 class="book-title">@item.BookName</h3>
                        <p class="book-author">@Localizer["Book_Card_ByAuthor", item.AuthorName]</p>
                        
                        <div class="availability-badge @(item.CopiesAvailable > 0 ? "available" : "unavailable")">
                            <span>@(item.CopiesAvailable > 0 ? "‚úì" : "‚úó")</span>
                            <span>@Localizer["Book_Status_AvailableCount", item.CopiesAvailable, item.CopiesTotal]</span>
                        </div>
                        
                        @if (!string.IsNullOrEmpty(item.BookDescription))
                        {
                            <p class="book-description">@item.BookDescription</p>
                        }
                        
                        <div class="book-details">
                            <div class="book-detail-item">
                                <span class="book-detail-label">@Localizer["Book_Table_Header_Year"]</span>
                                <span class="book-detail-value">@item.Year</span>
                            </div>
                            <div class="book-detail-item">
                                <span class="book-detail-label">@Localizer["Book_Table_Header_Publisher"]</span>
                                <span class="book-detail-value">@item.Publisher</span>
                            </div>
                            <div class="book-detail-item">
                                <span class="book-detail-label">@Localizer["Book_Filter_Label_Category"]</span>
                                <span class="book-detail-value">@item.CategoryName</span>
                            </div>
                            <div class="book-detail-item">
                                <span class="book-detail-label">@Localizer["Book_Card_Label_ID"]</span>
                                <span class="book-detail-value">#@item.BookId</span>
                            </div>
                        </div>
                        
                        
                        <div class="card-footer">
                            <a asp-action="Details" asp-route-id="@item.BookId" class="btn btn-info btn-sm">
                                <i class="fas fa-eye"></i> @Localizer["Global_Btn_ViewDetails"]
                            </a>

                            @if (User.IsInRole("admin") || User.IsInRole("lib"))
                            {
                                <a asp-action="Edit" asp-route-id="@item.BookId" class="btn btn-warning btn-sm">
                                    <i class="fas fa-edit"></i> @Localizer["Global_Btn_Edit"]
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.BookId" class="btn btn-danger btn-sm"
                                   onclick="return confirm('@Localizer["Book_Confirm_Delete"]')">
                                    <i class="fas fa-trash"></i> @Localizer["Global_Btn_Delete"]
                                </a>
                            }

                            @if (User.IsInRole("moderator") || User.IsInRole("admin"))
                            {
                                <a asp-action="Reviews" asp-route-id="@item.BookId" class="btn btn-dark btn-sm mt-1">
                                    <i class="fas fa-gavel"></i> @Localizer["Global_Btn_Moderate"]
                                </a>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-results">
            <div class="no-results-icon">üîç</div>
            <div class="no-results-text">@Localizer["Book_Empty_Title"]</div>
            <p>@Localizer["Book_Empty_Text"]</p>
        </div>
    }
</div>